# system setup
sudo: required

# setup language
language: go
go:
  - "1.11"

install:
  # download our task runner
  - go get github.com/AlecAivazis/run
  # install the ci dependencies
  - run install:ci

script:
  # install the dependencies
  - run install
  # generate and report the test coverage
  - run test:coverage

before_deploy:
  # build the binaries
  - run build

deploy:
  # only deploy on tagged releases
  on:
    tags: true
  # we need to push a github release with this tag
  provider: releases
  file:
    - "graphql-gateway_darwin_amd64"
    - "graphql-gateway_linux_amd64"
    - "graphql-gateway_windows_amd64"
  skip_cleanup: true

env:
  global:
    secure: N2uEZT26AnefAaieXkRs6v1EBdPeMy9itxRGibn9gHJQmffIhpUs43Mnx2iQoKhbD8MQHcUgpYCUCdJ5MOBYb+IySZ/5BVry2ZIuFW45NYPMKOODcxoqNQ2kR05u7CQwcyPfWw8I3YNP8aPiwkC1TCZVBQ3J29R0eUKFTV++sgiHiuW30rj84g0/smACVZkKkN8jpRD4qlVi/nbF1mz+v0v461Vb9ggsQJj7GH0yNgWOT/b8GmRYLDBmMlkpyLb4QYsMTb7BsQIoRTDfPW8swFcR9znLmpJBz00Y9hFwoRUo8t1N2jyYor91Mk9KIfrLP6VaZLcZmjdUk5bEK3CwqXZXWT6xajB1naJT3Ue+4mj/gILtP4BqmWTwpOg+C07olL45mLcV1EY+q3df3/VpAfItj1o9/I+ImV4pEbQIHAAhyyhwAx4mmkP0v28TwNNIoqWScY7PBykVCupHQdXiFJkG14X+bnSpTvx1WKGXL70KC12+qJ1jBdkBejBOReAaBIaPqMJBVyM1DXyfpHCkcCCU1v+nz5nHQIOFmCkpn73Ji2k3VCojuD9PN4DVMAyRnYBgMQOlv4dcOjJ2tRxtnN/6zqRHwuY/LUeAnTKJM4JJz5GGYLNb2+jzyevkxb7xcL+eqZgaO6zPi0Vi27SSBirZa6Sg/YsJnlixkYsch90=
